<!DOCTYPE html>
<html lang="zh-CN">
  <head>
  <meta charset="UTF-8">
  <meta 
    name="viewport"
    content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
  <meta 
    http-equiv="X-UA-Compatible" 
    content="ie=edge">
  <meta 
    name="theme-color" 
    content="#fff" 
    id="theme-color">
  <meta 
    name="description" 
    content="ç½‘ç»œå®‰å…¨ Android ML CTF">
  <link 
    rel="icon" 
    href="/images/logo.png">
  <title>Glibcå†…å­˜ç®¡ç†ç¬”è®°</title>
  
    
      <meta 
        property="og:title" 
        content="Glibcå†…å­˜ç®¡ç†ç¬”è®°">
    
    
      <meta 
        property="og:url" 
        content="https://ch3nye.top/Glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0/index.html">
    
    
      <meta 
        property="og:img" 
        content="/images/logo.png">
    
    
      <meta 
        property="og:img" 
        content="ç½‘ç»œå®‰å…¨ Android ML CTF">
    
    
      <meta 
        property="og:type" 
        content="article">
      <meta 
        property="og:article:published_time" 
        content="2021-09-05">
      <meta 
        property="og:article:modified_time" 
        content="2021-09-14">
      <meta 
        property="og:article:author" 
        content="Ch3nYe">
      
        
          <meta 
            property="og:article:tag" 
            content="å†…å­˜ç®¡ç†">
        
          <meta 
            property="og:article:tag" 
            content="Glibc">
        
          <meta 
            property="og:article:tag" 
            content="æ€»ç»“">
        
          <meta 
            property="og:article:tag" 
            content="å­¦ä¹ ">
        
      
    
  
  <script>
    function loadScript(url, cb) {
      var script = document.createElement('script');
      script.src = url;
      if (cb) script.onload = cb;
      script.async = true;
      document.body.appendChild(script);
    }
    function loadCSS(href, data, attr) {
      var sheet = document.createElement('link');
      sheet.ref = 'stylesheet';
      sheet.href = href;
      sheet.dataset[data] = attr;
      document.head.appendChild(sheet);
    }
    function changeCSS(cssFile, data, attr) {
      var oldlink = document.querySelector(data);
      var newlink = document.createElement("link");
      newlink.setAttribute("rel", "stylesheet");
      newlink.setAttribute("href", cssFile);
      newlink.dataset.prism = attr;
      document.head.replaceChild(newlink, oldlink);
    }
  </script>
  
    
      
      
      
      
        
        
        
        <script>
          function prismThemeChange() {
            if(document.getElementById('theme-color').dataset.mode === 'dark') {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism-tomorrow.min.css', '[data-prism]', 'prism-tomorrow');
              } else {
                loadCSS('/js/lib/prism/prism-tomorrow.min.css', 'prism', 'prism-tomorrow');
              }
            } else {
              if(document.querySelector('[data-prism]')) {
                changeCSS('/js/lib/prism/prism.min.css', '[data-prism]', 'prism');
              } else {
                loadCSS('/js/lib/prism/prism.min.css', 'prism', 'prism');
              }
            }
          }
          prismThemeChange()
        </script>
      
      
        
        <link rel="stylesheet" href="/js/lib/prism/prism-line-numbers.min.css">
      
    
  
  <script>
    // control reverse button
    var reverseDarkList = {
      dark: 'light',
      light: 'dark'
    };
    var themeColor = {
      dark: '#1c1c1e',
      light: '#fff'
    }
    // get the data of css prefers-color-scheme
    var getCssMediaQuery = function() {
      return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    };
    // reverse current darkmode setting function
    var reverseDarkModeSetting = function() {
      var setting = localStorage.getItem('user-color-scheme');
      if(reverseDarkList[setting]) {
        setting = reverseDarkList[setting];
      } else if(setting === null) {
        setting = reverseDarkList[getCssMediaQuery()];
      } else {
        return;
      }
      localStorage.setItem('user-color-scheme', setting);
      return setting;
    };
    // apply current darkmode setting
  </script>
  
    <script>
      var setDarkmode = function(mode) {
      var setting = mode || localStorage.getItem('user-color-scheme');
      if(setting === getCssMediaQuery()) {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else if(reverseDarkList[setting]) {
        document.documentElement.setAttribute('data-user-color-scheme', setting);
        document.getElementById('theme-color').content = themeColor[setting];
        document.getElementById('theme-color').dataset.mode = setting;
        prismThemeChange();
      } else {
        document.documentElement.removeAttribute('data-user-color-scheme');
        localStorage.removeItem('user-color-scheme');
        document.getElementById('theme-color').content = themeColor[getCssMediaQuery()];
        document.getElementById('theme-color').dataset.mode = getCssMediaQuery();
        prismThemeChange();
      }
    };
    setDarkmode();
    </script>
  
  
  <link rel="preload" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css" as="style" >
  <link rel="preload" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.js" as="script">
    <link rel="preload" href="/js/lib/lightbox/baguetteBox.min.css" as="style" >
  
  
    <link rel="preload" href="/js/lib/lozad.min.js" as="script">
  
  
  
  
    
    <link rel="prefetch" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" as="script">
  
  
    
    <link rel="prefetch" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js" as="script">
  
  
  
  <link rel="stylesheet" href="/css/main.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1946621_i1kgafibvw.css">
  
  <link rel="stylesheet" href="//at.alicdn.com/t/font_1952792_89b4ac4k4up.css">
  
    <link rel="stylesheet" href="/js/lib/lightbox/baguetteBox.min.css">
  
<meta name="generator" content="Hexo 5.3.0"></head>

  <body>
    <div class="wrapper">
       
      <nav class="navbar">
  <div class="navbar-logo">
    <span class="navbar-logo-main">
      
        <img 
          class="navbar-logo-img"
          width="32"
          height="32"
          src="/images/logo.png" 
          alt="blog logo">
      
      <span class="navbar-logo-dsc">ch3nye's blog</span>
    </span>
  </div>
  <div class="navbar-menu">
    
      <a 
        href="/" 
        class="navbar-menu-item">
        
          é¦–é¡µ
        
      </a>
    
      <a 
        href="/archives" 
        class="navbar-menu-item">
        
          å½’æ¡£
        
      </a>
    
      <a 
        href="/tags" 
        class="navbar-menu-item">
        
          æ ‡ç­¾
        
      </a>
    
      <a 
        href="/categories" 
        class="navbar-menu-item">
        
          åˆ†ç±»
        
      </a>
    
      <a 
        href="/about" 
        class="navbar-menu-item">
        
          å…³äº
        
      </a>
    
      <a 
        href="/links" 
        class="navbar-menu-item">
        
          å‹é“¾
        
      </a>
    
      <a 
        href="/shuoshuo" 
        class="navbar-menu-item">
        
          è¯´è¯´
        
      </a>
    
    <a 
      class="navbar-menu-item darknavbar" 
      id="dark">
      <i class="iconfont icon-weather"></i>
    </a>
    <a 
      class="navbar-menu-item searchnavbar" 
      id="search">
      <i 
        class="iconfont icon-search" 
        style="font-size: 1.2rem; font-weight: 400;">
      </i>
    </a>
  </div>
</nav> 
      
      <div 
        id="local-search" 
        style="display: none">
        <input
          class="navbar-menu-item"
          id="search-input"
          placeholder="è¯·è¾“å…¥æœç´¢å†…å®¹..." />
        <div id="search-content"></div>
      </div>
      
      <div class="section-wrap">
        <div class="container">
          <div class="columns">
            <main class="main-column">
<article class="card card-content">
  <header>
    <h1 class="post-title">
      Glibcå†…å­˜ç®¡ç†ç¬”è®°
    </h1>
  </header>
  <div class="post-meta post-show-meta">
    <time datetime="2021-09-04T16:00:00.000Z">
      <i 
        class="iconfont icon-calendar" 
        style="margin-right: 2px;">
      </i>
      <span>2021-09-05</span>
    </time>
    
      <span class="dot"></span>
      
        <a 
          href="/categories/%E7%AC%94%E8%AE%B0/" 
          class="post-meta-link">
          ç¬”è®°
        </a>
      
    
    
      <span class="dot"></span>
      <span>3.6k å­—</span>
    
  </div>
  
    <div 
      class="post-meta post-show-meta" 
      style="margin-top: -10px;">
      <div style="display: flex; align-items: center;">
        <i 
          class="iconfont icon-biaoqian" 
          style="margin-right: 2px; font-size: 1.15rem;">
        </i>
        
          
          <a 
            href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" 
            class="post-meta-link">
            å†…å­˜ç®¡ç†
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/Glibc/" 
            class="post-meta-link">
            Glibc
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/%E6%80%BB%E7%BB%93/" 
            class="post-meta-link">
            æ€»ç»“
          </a>
        
          
            <span class="dot"></span>
          
          <a 
            href="/tags/%E5%AD%A6%E4%B9%A0/" 
            class="post-meta-link">
            å­¦ä¹ 
          </a>
        
      </div>
    </div>
  
  </header>
  <div 
    id="section" 
    class="post-content">
    <h1 id="glibcå†…å­˜ç®¡ç†ç¬”è®°"><a class="markdownIt-Anchor" href="#glibcå†…å­˜ç®¡ç†ç¬”è®°"></a> Glibcå†…å­˜ç®¡ç†ç¬”è®°</h1>
<h2 id="0x0-èƒ¡è¯"><a class="markdownIt-Anchor" href="#0x0-èƒ¡è¯"></a> 0x0 èƒ¡è¯</h2>
<p>è®¡åˆ’ï¼š</p>
<ul>
<li>Linux ä¸‹çš„å†…å­˜ç®¡ç†ï¼šGlibc</li>
<li>Windows ä¸‹çš„å†…å­˜ç®¡ç†ï¼šHeapApi</li>
<li>Double Free</li>
<li>UAF</li>
</ul>
<p>windows é—­æºï¼Œæ‰€ä»¥ä»Linuxçš„å†…å­˜ç®¡ç†å¼€å§‹å­¦ä¹ </p>
<h2 id="0x1-è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼"><a class="markdownIt-Anchor" href="#0x1-è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼"></a> 0x1 è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼</h2>
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦ç›®çš„æ˜¯ï¼Œè®°å½•æˆ‘åœ¨å­¦ä¹ Glibcå†…å­˜ç®¡ç†çš„è¿‡ç¨‹ä¸­é˜…è¯»çš„ä¼˜ç§€å‚è€ƒæ–‡ç« ï¼Œé‡åˆ°çš„é—®é¢˜å’Œå¯¹åº”çš„è‡ªä¸»è§£ç­”ï¼ˆè§ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚ï¼‰ã€‚å¯¹è¯»è€…çš„ä½œç”¨ä»…ä»…æ˜¯æ¨èä¸€äº›å­¦ä¹ è¿™éƒ¨åˆ†çŸ¥è¯†çš„ä¼˜ç§€å‚è€ƒæ–‡ç« ï¼Œé¡¶å¤šå†å‚è€ƒä¸‹æˆ‘é‡åˆ°çš„é—®é¢˜ã€‚å¹¶ä¸æ˜¯è¯¦ç»†è®²è§£Glibcçš„æºç ï¼Œä¹Ÿæ²¡æœ‰å¯¹Glibcå†…å­˜ç®¡ç†ç­–ç•¥çš„ç³»ç»Ÿæ€§æè¿°ã€‚ä¸ºä»€ä¹ˆä¸å†™ï¼Ÿå› ä¸ºä¸æƒ³é‡å¤é€ è½®ï¼Œæˆ‘å†™çš„æ€ä¹ˆå¯èƒ½è¶…è¿‡æ‹¥æœ‰å¤šå¹´å†…æ ¸å±‚ç»éªŒçš„å‰è¾ˆã€‚</p>
<blockquote>
<p><strong>Glibc</strong>å°±æ˜¯<strong>GNU Cåº“</strong>ï¼Œæ˜¯GNUè®¡åˆ’æ‰€å®ç°çš„Cæ ‡å‡†åº“ã€‚å°½ç®¡å…¶åå­—ä¸­å¸¦æœ‰â€œCåº“â€ï¼Œä½†å®ƒç°åœ¨ä¹Ÿç›´æ¥æ”¯æŒC++ï¼ˆä»¥åŠé—´æ¥æ”¯æŒå…¶ä»–ç¼–ç¨‹è¯­è¨€ï¼‰ã€‚å®ƒä¸º<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GNU_Hurd">GNUç³»ç»Ÿ</a>ï¼Œ<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GNU/Linux">GNU/Linux</a>ç³»ç»Ÿå’Œä¸€äº›å…¶ä»–çš„<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E7%B1%BBUnix%E7%B3%BB%E7%BB%9F">ç±»Unixç³»ç»Ÿ</a>æä¾›äº†ç³»ç»Ÿæ ¸å¿ƒåº“ã€‚è¿™äº›åº“æä¾›äº†å…³é”®çš„APIï¼ŒåŒ…æ‹¬ISO C11ã€POSIX.1-2008å’ŒBSDæ‰€è§„å®šçš„APIå’Œä¸€äº›åº•å±‚APIï¼ŒåŒ…æ‹¬openã€readã€writeã€mallocã€printfã€getaddrinfoã€dlopenã€pthread_createã€cryptã€loginã€exitç­‰ã€‚</p>
<p>ref: <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GNU_C%E5%87%BD%E5%BC%8F%E5%BA%AB">GNU Cåº“ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)</a></p>
</blockquote>
<p>åƒè¿™ç§åº•å±‚å†…æ ¸æºç åº“ï¼Œä¹ä¸€çœ‹æ„Ÿè§‰å¾ˆéš¾è¯»æ‡‚ï¼Œå®é™…ä¸Šå°±æ˜¯ä¸æ‡‚çš„çŸ¥è¯†ç‚¹å¤ªå¤šäº†ï¼Œä½¿ç”¨äº†å¤§é‡çš„è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œçœ¼èŠ±ç¼­ä¹±çš„å®å®šä¹‰ï¼Œè®©äººä¸€ä¸‹å­æŠ“ä¸ä½è¦ç‚¹ï¼Œç†è§£ä¸äº†æ•´ä½“æ¡†æ¶ã€‚å°±å¥½åƒåˆšå­¦å®Œé«˜ä¸­è‹±è¯­4500è¯ï¼Œç»™æˆ‘ä¸€ç¯‡äºŒè¿›åˆ¶å­¦æœ¯è®ºæ–‡ï¼Œæ²¡è§è¿‡çš„å•è¯å¤ªå¤šäº†ï¼Œå½“ç„¶ç†è§£ä¸äº†æ–‡ç« ã€‚æ‰€ä»¥è¯´ä¸è¦ç€æ€¥ï¼Œä»åˆ«äººçš„åˆ†ææ–‡ç« å¼€å§‹çœ‹ï¼Œæœ€åè¯»ä¸€è¯»æºç ï¼Œè¿™æ ·çš„è¿‡ç¨‹å¤šåå¤è¿›è¡Œå‡ éå°±èƒ½å¯¹å®ƒæœ‰ä¸ªå¾ˆå¥½çš„ç†è§£äº†ã€‚æˆ‘æ˜¯å±äºå¤©èµ„æ„šé’çš„é‚£ç±»äººğŸ˜¥ï¼Œè¿™ç§æºç é˜…è¯»ä¸€èˆ¬éƒ½è¦è€—è´¹ä¸ªæŠŠæœˆï¼Œä½†æ˜¯æ²ƒè§‰å¾—å¾ˆå€¼ï¼Œä¹Ÿæ˜¯å¿…è¦çš„ï¼Œæ¯•ç«ŸåŸºæœ¬åŠŸè¦æ‰“æ‰å®ã€‚</p>
<h2 id="0x2-çŸ¥è¯†ç‚¹"><a class="markdownIt-Anchor" href="#0x2-çŸ¥è¯†ç‚¹"></a> 0x2 çŸ¥è¯†ç‚¹?</h2>
<h3 id="chunk-ç›¸å…³"><a class="markdownIt-Anchor" href="#chunk-ç›¸å…³"></a> chunk ç›¸å…³</h3>
<p>ref: <a target="_blank" rel="noopener" href="https://blog.csdn.net/dongyu_1989/article/details/81631271">(22æ¡æ¶ˆæ¯) linuxå †å†…å­˜ç®¡ç†mallocåˆ†æï¼ˆ3ï¼‰_dongyu_1989çš„åšå®¢-CSDNåšå®¢</a></p>
<p>æ–‡ç« å†…å®¹ï¼š</p>
<ul>
<li>
<p>samll bins &amp; large bins ä¸­chunkçš„ç”³è¯·ä¸é‡Šæ”¾</p>
</li>
<li>
<p>large binsä¸­æ¯ä¸ªåŒå‘å¾ªç¯é“¾è¡¨chunk sizeçš„å¤§å°åŒºé—´</p>
</li>
<li>
<p>ç»™å‡ºä¸€å¼ è¾ƒä¸ºè¯¦ç»†ä¸”æ¸…æ™°çš„Bins snapshot</p>
</li>
<li>
<p>Binsçš„åˆå§‹åŒ–</p>
</li>
</ul>
<p><img src="/images/20180813175037328" alt="img" / srcset="/images/LoadingImage.gif" data-src="/images/20180813175037328" class="lozad post-image"></p>
<p>è¿™æ˜¯ä¸€ä¸ªç³»åˆ—ï¼Œæ„Ÿè§‰è¿™ä¸ªä½œè€…å†™çš„æ¯”è¾ƒæ˜“æ‡‚ï¼Œä¸”è¯­ç—…ç›¸å¯¹è¾ƒå°‘ï¼Œå¯ä»¥è¯»ä¸€è¯»åŒç³»åˆ—å…¶ä»–æ–‡ç« ã€‚</p>
<h3 id="æ ¸å¿ƒç»“æ„ä½“"><a class="markdownIt-Anchor" href="#æ ¸å¿ƒç»“æ„ä½“"></a> æ ¸å¿ƒç»“æ„ä½“</h3>
<p><strong>malloc_state</strong></p>
<p>æ¯ä¸ªåˆ†é…åŒºæ˜¯struct malloc_stateçš„ä¸€ä¸ªå®ä¾‹ï¼Œptmallocä½¿ç”¨malloc_stateæ¥ç®¡ç†åˆ†é…åŒº.</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">malloc_state</span>
<span class="token punctuation">&#123;</span>
  <span class="token comment">/* Serialize access.  */</span>
  <span class="token function">__libc_lock_define</span> <span class="token punctuation">(</span><span class="token punctuation">,</span> mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Flags (formerly in max_fast).  */</span>
  <span class="token keyword">int</span> flags<span class="token punctuation">;</span>

  <span class="token comment">/* Set if the fastbin chunks contain recently inserted free blocks.  */</span>
  <span class="token comment">/* Note this is a bool but not all targets support atomics on booleans.  */</span>
  <span class="token keyword">int</span> have_fastchunks<span class="token punctuation">;</span>

  <span class="token comment">/* Fastbins */</span>
  mfastbinptr fastbinsY<span class="token punctuation">[</span>NFASTBINS<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/* Base of the topmost chunk -- not otherwise kept in a bin */</span>
  mchunkptr top<span class="token punctuation">;</span>

  <span class="token comment">/* The remainder from the most recent split of a small request */</span>
  mchunkptr last_remainder<span class="token punctuation">;</span>

  <span class="token comment">/* Normal bins packed as described above */</span>
  mchunkptr bins<span class="token punctuation">[</span>NBINS <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/* Bitmap of bins */</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> binmap<span class="token punctuation">[</span>BINMAPSIZE<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token comment">/* Linked list */</span>
  <span class="token keyword">struct</span> <span class="token class-name">malloc_state</span> <span class="token operator">*</span>next<span class="token punctuation">;</span>

  <span class="token comment">/* Linked list for free arenas.  Access to this field is serialized
     by free_list_lock in arena.c.  */</span>
  <span class="token keyword">struct</span> <span class="token class-name">malloc_state</span> <span class="token operator">*</span>next_free<span class="token punctuation">;</span>

  <span class="token comment">/* Number of threads attached to this arena.  0 if the arena is on
     the free list.  Access to this field is serialized by
     free_list_lock in arena.c.  */</span>
  INTERNAL_SIZE_T attached_threads<span class="token punctuation">;</span>

  <span class="token comment">/* Memory allocated from the system in this arena.  */</span>
  INTERNAL_SIZE_T system_mem<span class="token punctuation">;</span>
  INTERNAL_SIZE_T max_system_mem<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>malloc_par</strong></p>
<p>å‚æ•°ç®¡ç†ä½¿ç”¨struct malloc_parï¼Œå…¨å±€æ‹¥æœ‰ä¸€ä¸ªå”¯ä¸€çš„malloc_parå®ä¾‹.</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">struct malloc_par
&#123;
  &#x2F;* Tunable parameters *&#x2F;
  unsigned long trim_threshold;
  INTERNAL_SIZE_T top_pad;
  INTERNAL_SIZE_T mmap_threshold;
  INTERNAL_SIZE_T arena_test;
  INTERNAL_SIZE_T arena_max;

  &#x2F;* Memory map support *&#x2F;
  int n_mmaps;
  int n_mmaps_max;
  int max_n_mmaps;
  &#x2F;* the mmap_threshold is dynamic, until the user sets
     it manually, at which point we need to disable any
     dynamic behavior. *&#x2F;
  int no_dyn_threshold;

  &#x2F;* Statistics *&#x2F;
  INTERNAL_SIZE_T mmapped_mem;
  INTERNAL_SIZE_T max_mmapped_mem;

  &#x2F;* First address handed out by MORECORE&#x2F;sbrk.  *&#x2F;
  char *sbrk_base;

#if USE_TCACHE
  &#x2F;* Maximum number of buckets to use.  *&#x2F;
  size_t tcache_bins;
  size_t tcache_max_bytes;
  &#x2F;* Maximum number of chunks in each bucket.  *&#x2F;
  size_t tcache_count;
  &#x2F;* Maximum number of chunks to remove from the unsorted list, which
     aren&#39;t used to prefill the cache.  *&#x2F;
  size_t tcache_unsorted_limit;
#endif
&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>malloc_chunk</strong></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">struct malloc_chunk &#123;

  INTERNAL_SIZE_T      mchunk_prev_size;  &#x2F;* Size of previous chunk (if free).  *&#x2F;
  INTERNAL_SIZE_T      mchunk_size;       &#x2F;* Size in bytes, including overhead. *&#x2F;

  struct malloc_chunk* fd;         &#x2F;* double links -- used only if free. *&#x2F;
  struct malloc_chunk* bk;

  &#x2F;* Only used for large blocks: pointer to next larger size.  *&#x2F;
  struct malloc_chunk* fd_nextsize; &#x2F;* double links -- used only if free. *&#x2F;
  struct malloc_chunk* bk_nextsize;
&#125;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>heap_info</strong></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">typedef struct _heap_info
&#123;
  mstate ar_ptr; &#x2F;* Arena for this heap. *&#x2F;
  struct _heap_info *prev; &#x2F;* Previous heap. *&#x2F;
  size_t size;   &#x2F;* Current size in bytes. *&#x2F;
  size_t mprotect_size; &#x2F;* Size in bytes that has been mprotected
                           PROT_READ|PROT_WRITE.  *&#x2F;
  &#x2F;* Make sure the following data is properly aligned, particularly
     that sizeof (heap_info) + 2 * SIZE_SZ is a multiple of
     MALLOC_ALIGNMENT. *&#x2F;
  char pad[-6 * SIZE_SZ &amp; MALLOC_ALIGN_MASK];
&#125; heap_info;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚"><a class="markdownIt-Anchor" href="#0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚"></a> 0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚</h2>
<h3 id="chunk-å¤§å°çš„è®¡ç®—å…¬å¼"><a class="markdownIt-Anchor" href="#chunk-å¤§å°çš„è®¡ç®—å…¬å¼"></a> Chunk å¤§å°çš„è®¡ç®—å…¬å¼ï¼Ÿ</h3>
<ul>
<li>
<p>ä¸€ä¸ªä½¿ç”¨ä¸­çš„chunkçš„å¤§å°ï¼šin_use_size  =  (ç”¨æˆ·è¯·æ±‚å¤§å°+2*SIZE_SZ-SIZE_SZ)  align to 8Bï¼Œå‡†ç¡®æ¥è¯´æ˜¯mallocåˆ†é…çš„binsä¸Šçš„chunk</p>
<p>å‚è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/lattera/glibc/blob/master/malloc/malloc.c#L1072">glibc/malloc.c at master Â· lattera/glibc (github.com)</a></p>
<p>mmapåˆ†é…æ—¶æ²¡æœ‰ç›¸é‚»çš„ä¸Šä¸‹chunkï¼Œæ­¤æ—¶in_use_size  =  (ç”¨æˆ·è¯·æ±‚å¤§å°+2*SIZE_SZ) align to 8B</p>
</li>
<li>
<p>ç©ºé—²chunkè‡³å°‘éœ€è¦4ä¸ªSIZE_SZçš„å¤§å°ï¼Œç”¨äºå­˜å‚¨prev_sizeï¼Œsizeï¼Œfdå’Œbk</p>
<p>å‚è§ï¼š<a target="_blank" rel="noopener" href="https://github.com/lattera/glibc/blob/master/malloc/malloc.c#L1098">glibc/malloc.c at master Â· lattera/glibc (github.com)</a></p>
</li>
<li>
<p>ç”±äºç©ºé—²chunkå’Œä½¿ç”¨ä¸­çš„chunkä½¿ç”¨åŒä¸€å—ç©ºé—´ï¼Œæ‰€ä»¥è‚¯å®šè¦å–ä¸¤è€…æœ€å¤§çš„ä¸€ä¸ªä½œä¸ºæœ€ç»ˆçš„åˆ†é…ç©ºé—´ï¼šchunk_size  =  max(in_use_size, 16)</p>
</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸ"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸ"></a> ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„Chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸï¼Ÿ</h3>
<p>prev_sizeå­—æ®µè™½ç„¶åœ¨å½“å‰chunkå—ç»“æ„ä½“å†…ï¼Œè®°å½•çš„å´æ˜¯å‰ä¸€ä¸ªé‚»æ¥chunkå—çš„ä¿¡æ¯ï¼Œè¿™æ ·åšçš„å¥½å¤„ï¼Œæˆ–è€…è¯´ç›®çš„ï¼Œå°±æ˜¯<strong>æˆ‘ä»¬é€šè¿‡æœ¬å—chunkç»“æ„ä½“å°±å¯ä»¥ç›´æ¥è·å–åˆ°å‰ä¸€chunkå—çš„åœ°å€</strong>ï¼Œä»è€Œæ–¹ä¾¿åšè¿›ä¸€æ­¥çš„å¤„ç†æ“ä½œã€‚ç›¸å¯¹çš„ï¼Œå½“å‰chunkå—çš„footä¿¡æ¯å°±å­˜åœ¨äºä¸‹ä¸€ä¸ªé‚»æ¥chunkå—çš„ç»“æ„ä½“å†…ã€‚å­—æ®µprev_sizeè®°å½•çš„ä¿¡æ¯ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<p>1ï¼‰å¦‚æœå‰ä¸€ä¸ªé‚»æ¥chunkå—ç©ºé—²ï¼Œé‚£ä¹ˆå½“å‰chunkå—ç»“æ„ä½“å†…çš„prev_sizeå­—æ®µè®°å½•çš„æ˜¯å‰ä¸€ä¸ªé‚»æ¥chunkå—çš„å¤§å°ã€‚è¿™å°±æ˜¯ç”±å½“å‰chunkæŒ‡é’ˆè·å¾—å‰ä¸€ä¸ªç©ºé—²chunkåœ°å€çš„ä¾æ®ã€‚å®prev_chunkÂ§å°±æ˜¯ä¾èµ–è¿™ä¸ªå‡è®¾å®ç°çš„ã€‚</p>
<p>2ï¼‰å¦‚æœå‰ä¸€ä¸ªé‚»æ¥chunkåœ¨ä½¿ç”¨ä¸­ï¼Œåˆ™å½“å‰chunkçš„prev_sizeçš„ç©ºé—´è¢«å‰ä¸€ä¸ªchunkå€Ÿç”¨ä¸­ï¼Œå…¶ä¸­çš„å€¼æ˜¯å‰ä¸€ä¸ªchunkçš„å†…å­˜å†…å®¹ï¼Œå¯¹å½“å‰chunkæ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚æ­¤æ—¶ä¸Šä¸€ä¸ªchunkä¸èƒ½ç”¨ä½œåˆ†é…ï¼Œç®¡ç†å™¨ä¸éœ€è¦è·å–ä¸Šä¸€ä¸ªchunkçš„åœ°å€ï¼Œæ‰€ä»¥è¿™ä¸ªprev_sizeä¹Ÿå°±æ²¡æœ‰ç”¨äº†ã€‚å­—æ®µsizeè®°å½•äº†æœ¬chunkçš„å¤§å°ï¼Œæ— è®ºä¸‹ä¸€ä¸ªchunkæ˜¯ç©ºé—²çŠ¶æ€æˆ–æ˜¯è¢«ä½¿ç”¨çŠ¶æ€ï¼Œéƒ½å¯ä»¥é€šè¿‡æœ¬chunkçš„åœ°å€åŠ ä¸Šæœ¬chunkçš„å¤§å°ï¼Œå¾—åˆ°ä¸‹ä¸€ä¸ªchunkçš„åœ°å€ï¼Œç”±äºsizeçš„ä½3ä¸ªbitè®°å½•äº†æ§åˆ¶ä¿¡æ¯ï¼Œéœ€è¦å±è”½æ‰è¿™äº›æ§åˆ¶ä¿¡æ¯ï¼Œå–å‡ºå®é™…çš„sizeåœ¨è¿›è¡Œè®¡ç®—ä¸‹ä¸€ä¸ªchunkåœ°å€ï¼Œè¿™æ˜¯next_chunkÂ§çš„å®ç°åŸç†ã€‚</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">&#x2F;* Ptr to previous physical malloc_chunk.  Only valid if !prev_inuse (P).  *&#x2F;
#define prev_chunk(p) ((mchunkptr) (((char *) (p)) - prev_size (p)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">&#x2F;* Ptr to next physical malloc_chunk. *&#x2F;
#define next_chunk(p) ((mchunkptr) (((char *) (p)) + chunksize (p)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å®chunksizeÂ§ç”¨äºè·å¾—chunkçš„å®é™…å¤§å°ï¼Œéœ€è¦å±è”½æ‰sizeä¸­çš„æ§åˆ¶ä¿¡æ¯ã€‚</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">&#x2F;* Get size, ignoring use bits *&#x2F;
#define chunksize(p) (chunksize_nomask (p) &amp; ~(SIZE_BITS))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>å®chunk_at_offset(p, s)å°†p+sçš„åœ°å€å¼ºåˆ¶çœ‹ä½œä¸€ä¸ªchunkã€‚</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">&#x2F;* Treat space at ptr + offset as a chunk *&#x2F;
#define chunk_at_offset(p, s)  ((mchunkptr) (((char *) (p)) + (s)))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="ä¸ºä»€ä¹ˆchunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨"><a class="markdownIt-Anchor" href="#ä¸ºä»€ä¹ˆchunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨"></a> ä¸ºä»€ä¹ˆChunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨ï¼Ÿ</h3>
<p>chunkåœ¨åˆ†å‰²æ—¶æ€»æ˜¯ä»¥åœ°å€å¯¹é½ï¼Œé»˜è®¤æ˜¯8å­—èŠ‚å¯¹é½ï¼Œå¯¹é½å€¼å¯ä»¥è‡ªå®šä¹‰ï¼Œä½†æ˜¯å¿…é¡»æ¯”é»˜è®¤å€¼å¤§ä¸”æ˜¯<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mn>2</mn><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">2^n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.664392em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.664392em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span></span></span></span></span></span></span></span>ï¼Œè¿™æ ·çš„è¯ä½ä¸‰ä½æ€»æ˜¯0ï¼Œå°±å¯ä»¥å¤ç”¨ã€‚</p>
<ul>
<li>
<p>ä»¥ç¬¬0ä½ä½œä¸ºPçŠ¶æ€ä½ï¼Œæ ‡è®°å‰ä¸€chunkå—æ˜¯å¦åœ¨ä½¿ç”¨ä¸­ï¼Œä¸º1è¡¨ç¤ºä½¿ç”¨ï¼Œä¸º0è¡¨ç¤ºç©ºé—²ã€‚</p>
</li>
<li>
<p>ä»¥ç¬¬1ä½ä½œä¸ºMçŠ¶æ€ä½ï¼Œæ ‡è®°æœ¬chunkå—æ˜¯å¦æ˜¯ä½¿ç”¨mmap()ç›´æ¥ä»è¿›ç¨‹çš„mmapæ˜ å°„åŒºåŸŸåˆ†é…çš„ï¼Œä¸º1è¡¨ç¤ºæ˜¯ï¼Œä¸º0è¡¨ç¤ºå¦ã€‚</p>
</li>
<li>
<p>ä»¥ç¬¬2ä½ä½œä¸ºAçŠ¶æ€ä½ï¼Œæ ‡è®°æœ¬chunkæ˜¯å¦å±äºéä¸»åˆ†é…åŒºï¼Œä¸º1è¡¨ç¤ºæ˜¯ï¼Œä¸º0è¡¨ç¤ºå¦ã€‚</p>
</li>
</ul>
<h3 id="chunk-bins-å¦‚ä½•åˆå§‹åŒ–"><a class="markdownIt-Anchor" href="#chunk-bins-å¦‚ä½•åˆå§‹åŒ–"></a> Chunk Bins å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</h3>
<p>åˆ†é…åŒºmain_arenaåˆå§‹åŒ–å‡½æ•°:</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">static void
malloc_init_state (mstate av)&#x2F;&#x2F;mstate &#x3D;&#x3D; malloc_state
&#123;
  int i;
  mbinptr bin;

  &#x2F;* Establish circular links for normal bins *&#x2F;
  for (i &#x3D; 1; i &lt; NBINS; ++i)
    &#123;
      bin &#x3D; bin_at (av, i);
      bin-&gt;fd &#x3D; bin-&gt;bk &#x3D; bin;
    &#125;

#if MORECORE_CONTIGUOUS
  if (av !&#x3D; &amp;main_arena)
#endif
  set_noncontiguous (av);&#x2F;&#x2F;å¯¹äºéä¸»åˆ†é…åŒº è®¾ç½®ä¸ºåˆ†é…éè¿ç»­è™šæ‹Ÿåœ°å€ç©ºé—´
  if (av &#x3D;&#x3D; &amp;main_arena)
    set_max_fast (DEFAULT_MXFAST);&#x2F;&#x2F;è®¾ç½®fastbinsä¸­æœ€å¤§chunkå¤§å°
  atomic_store_relaxed (&amp;av-&gt;have_fastchunks, false);&#x2F;&#x2F;åˆ†é…åŒºä¸­æ˜¯å¦æœ‰fastchunk åˆå§‹åŒ–ç½®é

  av-&gt;top &#x3D; initial_top (av);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ä¸Šè¿°ä»£ç ä¸­<code>bin_at(m, i)</code>æ˜¯å–åˆ†é…åŒºçš„å®ä¾‹mä¸­ç¬¬iä¸ªbin:</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">typedef struct malloc_chunk *mbinptr;

&#x2F;* addressing -- note that bin_at(0) does not exist *&#x2F;
#define bin_at(m, i) \
  (mbinptr) (((char *) &amp;((m)-&gt;bins[((i) - 1) * 2]))			      \
             - offsetof (struct malloc_chunk, fd))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#define NONCONTIGUOUS_BIT     (2U)

#define contiguous(M)          (((M)-&gt;flags &amp; NONCONTIGUOUS_BIT) &#x3D;&#x3D; 0)
#define noncontiguous(M)       (((M)-&gt;flags &amp; NONCONTIGUOUS_BIT) !&#x3D; 0)
#define set_noncontiguous(M)   ((M)-&gt;flags |&#x3D; NONCONTIGUOUS_BIT)
#define set_contiguous(M)      ((M)-&gt;flags &amp;&#x3D; ~NONCONTIGUOUS_BIT)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>åˆ†é…åŒºçš„åˆå§‹åŒ–å‡½æ•°é»˜è®¤åˆ†é…åŒºçš„å®ä¾‹avæ˜¯å…¨å±€é™æ€å˜é‡æˆ–æ˜¯å·²ç»å°†avä¸­çš„æ‰€æœ‰å­—æ®µéƒ½æ¸…0äº†ã€‚åˆå§‹åŒ–å‡½æ•°åšçš„å·¥ä½œæ¯”è¾ƒç®€å•ï¼Œé¦–å…ˆéå†æ‰€æœ‰çš„binsï¼Œåˆå§‹åŒ–æ¯ä¸ªbinçš„ç©ºé—²é“¾è¡¨ä¸ºç©ºï¼Œå³å°†binçš„fbå’Œbkéƒ½æŒ‡å‘binæœ¬èº«ã€‚ç”±äºavä¸­æ‰€æœ‰å­—æ®µé»˜è®¤ä¸º0ï¼Œå³é»˜è®¤åˆ†é…è¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œä½†åªæœ‰ä¸»åˆ†é…åŒºæ‰èƒ½åˆ†é…è¿ç»­çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæ‰€ä»¥å¯¹äºéä¸»åˆ†é…åŒºï¼Œéœ€è¦è®¾ç½®ä¸ºåˆ†é…éè¿ç»­è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å¦‚æœåˆå§‹åŒ–çš„æ˜¯ä¸»åˆ†é…åŒºï¼Œéœ€è¦è®¾ç½®fastbinsä¸­æœ€å¤§chunkå¤§å°ï¼Œç”±äºä¸»åˆ†é…åŒºåªæœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”ä¸€å®šæ˜¯æœ€å…ˆåˆå§‹åŒ–ï¼Œè¿™å°±ä¿è¯äº†å¯¹å…¨å±€å˜é‡global_max_faståªåˆå§‹åŒ–äº†ä¸€æ¬¡ï¼Œåªè¦è¯¥å…¨å±€å˜é‡çš„å€¼é0ï¼Œä¹Ÿå°±æ„å‘³ç€ä¸»åˆ†é…åŒºåˆå§‹åŒ–äº†ã€‚æœ€ååˆå§‹åŒ–top chunk.</p>
<h3 id="åˆ†é…åŒºarenaæ€ä¹ˆç†è§£"><a class="markdownIt-Anchor" href="#åˆ†é…åŒºarenaæ€ä¹ˆç†è§£"></a> åˆ†é…åŒº(arena)æ€ä¹ˆç†è§£ï¼Ÿ</h3>
<p>å¹¶å‘æ¡ä»¶ä¸‹ï¼Œ<code>main_arena</code>å¼•å‘çš„ç«äº‰å°†ä¼šæˆä¸ºé™åˆ¶ç¨‹åºæ€§èƒ½çš„ç“¶é¢ˆæ‰€åœ¨ï¼Œå› æ­¤glibcé‡‡ç”¨äº†å¤šarenaæœºåˆ¶ï¼Œçº¿ç¨‹Aåˆ†é…å†…å­˜æ—¶è·å–<code>main_arena</code>é”æˆåŠŸï¼Œå°†åœ¨<code>main_arena</code>æ‰€ç®¡ç†çš„å†…å­˜ä¸­åˆ†é…ï¼›æ­¤æ—¶çº¿ç¨‹Bè·å–<code>main_arena</code>å¤±è´¥ï¼Œglibcä¼šæ–°å»ºä¸€ä¸ªarena1ï¼Œæ­¤æ¬¡å†…å­˜åˆ†é…ä»arena1ä¸­è¿›è¡Œã€‚<br />
è¿™ç§ç­–ç•¥ï¼Œä¸€å®šç¨‹åº¦ä¸Šè§£å†³äº†å¤šçº¿ç¨‹ä¸‹ç«äº‰çš„é—®é¢˜ï¼›ä½†æ˜¯éšç€arenaçš„å¢å¤šï¼Œå†…å­˜ç¢ç‰‡å‡ºç°çš„å¯èƒ½æ€§ä¹Ÿå˜å¤§äº†ã€‚ä¾‹å¦‚ï¼Œmain_arenaä¸­æœ‰10kã€20kçš„ç©ºé—²å†…å­˜ï¼Œçº¿ç¨‹Bè¦è·å–20kçš„ç©ºé—²å†…å­˜ï¼Œä½†æ˜¯è·å–main_arenaé”å¤±è´¥ï¼Œå¯¼è‡´ç•™ä¸‹20kçš„ç¢ç‰‡ï¼Œé™ä½äº†å†…å­˜ä½¿ç”¨ç‡ã€‚</p>
<p>æ™®é€šarenaçš„å†…éƒ¨ç»“æ„:</p>
<p><img src="/images/10681867-82a67604bbf771cb.png" alt="æ™®é€šarenaç»“æ„" / srcset="/images/LoadingImage.gif" data-src="/images/10681867-82a67604bbf771cb.png" class="lozad post-image"></p>
<ol>
<li><strong>ä¸€ä¸ªarenaç”±å¤šä¸ªHeapæ„æˆ</strong></li>
<li>æ¯ä¸ªHeapé€šè¿‡mmapè·å¾—ï¼Œæœ€å¤§ä¸º1Mï¼Œå¤šä¸ªHeapé—´å¯èƒ½ä¸ç›¸é‚»</li>
<li>Heapç”±<code>_heap_info</code>ç»“æ„ä½“ç»„ç»‡ï¼ŒHeapä¹‹é—´æœ‰<code>struct _heap_info *prev</code>æŒ‡é’ˆæŒ‡å‘å‰ä¸€ä¸ªHeap</li>
<li>æœ€ä¸Šé¢çš„Heapï¼Œä¹Ÿæœ‰top chunk</li>
</ol>
<p>æ¯ä¸ªHeapé‡Œé¢ä¹Ÿæ˜¯ç”±chunkç»„æˆï¼Œä½¿ç”¨å’Œmain_arenaå®Œå…¨ç›¸åŒçš„ç®¡ç†æ–¹å¼ç®¡ç†ç©ºé—²chunkã€‚<br />
arenaä½¿ç”¨<code>malloc_state</code>ç»“æ„ä½“æè¿°ï¼Œå¤šä¸ªarenaä¹‹é—´æ˜¯é€šè¿‡<code>struct malloc_state *next</code>ä»¥é“¾è¡¨è¿æ¥çš„ã€‚å¦‚ä¸‹å›¾:</p>
<p><img src="/images/10681867-ebbad1ec41e46282.png" alt="arenaé“¾è¡¨" / srcset="/images/LoadingImage.gif" data-src="/images/10681867-ebbad1ec41e46282.png" class="lozad post-image"></p>
<p>ref: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2fedeacfa797">glibcå†…å­˜ç®¡ç†é‚£äº›äº‹å„¿ - ç®€ä¹¦ (jianshu.com)</a></p>
<h3 id="main-arenaä¸»åˆ†é…åŒºnon-main-arena-éä¸»åˆ†é…åŒºæ™®é€šarenaå¦‚ä½•åŒºåˆ†"><a class="markdownIt-Anchor" href="#main-arenaä¸»åˆ†é…åŒºnon-main-arena-éä¸»åˆ†é…åŒºæ™®é€šarenaå¦‚ä½•åŒºåˆ†"></a> main arenaä¸»åˆ†é…åŒº&amp;non main arena éä¸»åˆ†é…åŒºï¼ˆæ™®é€šarenaï¼‰å¦‚ä½•åŒºåˆ†ï¼Ÿ</h3>
<p>ä¸»åˆ†é…åŒº&amp;éä¸»åˆ†é…åŒº</p>
<p>main_arena&amp;non_main_arena</p>
<p>æˆ‘çŒœåº”è¯¥æ˜¯ä¸‹é¢çš„å®šä¹‰ï¼š</p>
<blockquote>
<p><strong>1. Primary / Main memory:</strong><br />
Primary memory is the computer memory that is directly accessible by CPU. It is comprised of DRAM and provides the actual working space to the processor. It holds the data and instructions that the processor is currently working on.</p>
<p><strong>2. Secondary Memory / Mass Storage:</strong><br />
The contents of the secondary memory first get transferred to the primary memory and then are accessed by the processor, this is because the processor does not directly interact with the secondary memory.</p>
<p>ref: <a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/difference-between-primary-and-secondary-memory/">Difference between Primary and Secondary Memory - GeeksforGeeks</a></p>
</blockquote>
<p>åŒºåˆ«ï¼š</p>
<p>æ¯ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªä¸»åˆ†é…åŒºï¼Œä½†å¯èƒ½å­˜åœ¨å¤šä¸ªéä¸»åˆ†é…åŒºï¼Œptmallocæ ¹æ®ç³»ç»Ÿå¯¹åˆ†é…åŒºçš„äº‰ç”¨æƒ…å†µåŠ¨æ€å¢åŠ éä¸»åˆ†é…åŒºçš„æ•°é‡ï¼Œåˆ†é…åŒºçš„æ•°é‡ä¸€æ—¦å¢åŠ ï¼Œå°±ä¸ä¼šå†å‡å°‘äº†ã€‚ä¸»åˆ†é…åŒºå¯ä»¥è®¿é—®è¿›ç¨‹çš„heapåŒºåŸŸå’Œmmapæ˜ å°„åŒºåŸŸï¼Œä¹Ÿå°±æ˜¯è¯´ä¸»åˆ†é…åŒºå¯ä»¥ä½¿ç”¨brkå’Œmmapå‘æ“ä½œç³»ç»Ÿç”³è¯·è™šæ‹Ÿå†…å­˜ã€‚è€Œéä¸»åˆ†é…åŒºåªèƒ½è®¿é—®è¿›ç¨‹çš„mmapæ˜ å°„åŒºåŸŸï¼Œéä¸»åˆ†é…åŒºæ¯æ¬¡ä½¿ç”¨mmap()å‘æ“ä½œç³»ç»Ÿâ€œæ‰¹å‘â€HEAP_MAX_SIZEï¼ˆ32ä½ç³»ç»Ÿä¸Šé»˜è®¤ä¸º1MBï¼Œ64ä½ç³»ç»Ÿé»˜è®¤ä¸º64MBï¼‰å¤§å°çš„è™šæ‹Ÿå†…å­˜ï¼Œå½“ç”¨æˆ·å‘éä¸»åˆ†é…åŒºè¯·æ±‚åˆ†é…å†…å­˜æ—¶å†åˆ‡å‰²æˆå°å—â€œé›¶å”®â€å‡ºå»ï¼Œæ¯•ç«Ÿç³»ç»Ÿè°ƒç”¨æ˜¯ç›¸å¯¹ä½æ•ˆçš„ï¼Œç›´æ¥ä»ç”¨æˆ·ç©ºé—´åˆ†é…å†…å­˜å¿«å¤šäº†ã€‚æ‰€ä»¥ptmallocåœ¨å¿…è¦çš„æƒ…å†µä¸‹æ‰ä¼šè°ƒç”¨mmap()å‡½æ•°å‘æ“ä½œç³»ç»Ÿç”³è¯·è™šæ‹Ÿå†…å­˜ã€‚</p>
<p>ref: glibcå†…å­˜ç®¡ç†ptmallocæºä»£ç åˆ†æ.pdf â€“ ååº­ï¼ˆåº„æ˜å¼ºï¼‰</p>
<p><strong>main arenaå’Œæ™®é€šarena(non main arena)çš„åŒºåˆ«</strong></p>
<blockquote>
<p><code>main_arena</code>æ˜¯ä¸ºä¸€ä¸ªä½¿ç”¨brkæŒ‡é’ˆçš„arenaï¼Œç”±äºbrkæ˜¯å †é¡¶æŒ‡é’ˆï¼Œä¸€ä¸ªè¿›ç¨‹ä¸­åªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œå› æ­¤æ™®é€šarenaæ— æ³•ä½¿ç”¨brkè¿›è¡Œå†…å­˜åˆ†é…ã€‚æ™®é€šarenaå»ºç«‹åœ¨mmapçš„æœºåˆ¶ä¸Šï¼Œå†…å­˜ç®¡ç†æ–¹å¼å’Œ<code>main_arena</code>ç±»ä¼¼ï¼Œåªæœ‰ä¸€ç‚¹åŒºåˆ«ï¼Œæ™®é€šarenaåªæœ‰åœ¨æ•´ä¸ªarenaéƒ½ç©ºé—²æ—¶ï¼Œæ‰ä¼šè°ƒç”¨<code>munmap</code>æŠŠå†…å­˜è¿˜ç»™æ“ä½œç³»ç»Ÿã€‚</p>
<p>ref: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2fedeacfa797">glibcå†…å­˜ç®¡ç†é‚£äº›äº‹å„¿ - ç®€ä¹¦ (jianshu.com)</a></p>
</blockquote>
<h3 id="mallocä¸­mmapå’Œbrkçš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#mallocä¸­mmapå’Œbrkçš„åŒºåˆ«"></a> mallocä¸­mmapå’Œbrkçš„åŒºåˆ«</h3>
<p>ä»æ“ä½œç³»ç»Ÿè§’åº¦æ¥çœ‹ï¼Œè¿›ç¨‹åˆ†é…å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼Œåˆ†åˆ«ç”±ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å®Œæˆï¼šbrkå’Œmmapï¼ˆä¸è€ƒè™‘å…±äº«å†…å­˜ï¼‰ã€‚</p>
<p>1ã€brkæ˜¯å°†æ•°æ®æ®µ(.data)çš„æœ€é«˜åœ°å€æŒ‡é’ˆ_edataå¾€é«˜åœ°å€æ¨ï¼›</p>
<p>2ã€mmapæ˜¯åœ¨è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ï¼ˆå †å’Œæ ˆä¸­é—´ï¼Œç§°ä¸ºæ–‡ä»¶æ˜ å°„åŒºåŸŸçš„åœ°æ–¹ï¼‰æ‰¾ä¸€å—ç©ºé—²çš„è™šæ‹Ÿå†…å­˜ã€‚</p>
<p>æ³¨æ„è¿™ä¸¤ç§æ–¹å¼åˆ†é…çš„éƒ½æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œå¦‚æœåœ¨ç¬¬ä¸€æ¬¡è®¿é—®å·²åˆ†é…çš„è™šæ‹Ÿå†…å­˜æ—¶å‘ç”Ÿä¸­æ–­ï¼Œåˆ™ç”±OSè´Ÿè´£åˆ†é…ç‰©ç†å†…å­˜.</p>
<p>ref: <a target="_blank" rel="noopener" href="https://www.huaweicloud.com/articles/914992dae65b7f7c6635c93e10d3ae1c.html">https://www.huaweicloud.com/articles/914992dae65b7f7c6635c93e10d3ae1c.html</a></p>
<p>ref: <a target="_blank" rel="noopener" href="https://leviathan.vip/2019/01/13/mmap%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">https://leviathan.vip/2019/01/13/mmapæºç åˆ†æ/</a></p>
<h3 id="å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› "><a class="markdownIt-Anchor" href="#å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› "></a> å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› </h3>
<p>top chunkä¸æ”¶ç¼©ï¼Œå†…å­˜å°±æ— æ³•å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œå¯¼è‡´å†…å­˜ç¢ç‰‡çš„å‡ºç°.</p>
<h2 id="æ¨èé¡ºåºé˜…è¯»"><a class="markdownIt-Anchor" href="#æ¨èé¡ºåºé˜…è¯»"></a> æ¨èé¡ºåºé˜…è¯»ï¼š</h2>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/papers/Archive/refs/heap/glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86ptmalloc%E6%BA%90%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90.pdf">Glibcå†…å­˜ç®¡ç†Ptmalloc2æºä»£ç åˆ†æååº­ï¼ˆåº„æ˜å¼ºï¼‰2011/4/17.pdf</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2fedeacfa797">glibcå†…å­˜ç®¡ç†é‚£äº›äº‹å„¿ - ç®€ä¹¦ (jianshu.com)</a></p>
<p>æºç ï¼š</p>
<p><a target="_blank" rel="noopener" href="https://github.com/lattera/glibc/blob/master/malloc/malloc.c">source code: glibc/malloc.c at master Â· lattera/glibc (github.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/lattera/glibc/blob/master/malloc/arena.c">source code: glibc/arena.c at master Â· lattera/glibc (github.com)</a></p>
<p>é™„åŠ å‚è€ƒï¼š</p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/149782">linux_ptmallocä¸‹malloc()çš„è¿‡ç¨‹ï¼šæœ‰ ptmalloc æºç  - å®‰å…¨å®¢ï¼Œå®‰å…¨èµ„è®¯å¹³å° (anquanke.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://paper.seebug.org/445/#pwnfastbin">glibc mallocå­¦ä¹ ç¬”è®°ä¹‹fastbin (seebug.org) #åœ¨Pwné¢˜ä¸­fastbinçš„åˆ©ç”¨</a></p>

  </div>
  <div>
    
      <div 
        class="post-note note-info copyright" 
        style="margin-top: 42px">
        <p>
          <span style="font-weight: bold;">ä½œè€…ï¼š</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="/about">
            Ch3nYe
          </a>
        </p>
        <p>
          <span style="font-weight: bold;">æ–‡ç« é“¾æ¥ï¼š</span><a 
            target="_blank" 
            rel="nofollow noopener noreferrer" 
            href="https://ch3nye.top/Glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0/">
            https://ch3nye.top/Glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0/
          </a>
        </p>
        <p><span style="font-weight: bold;">ç‰ˆæƒå£°æ˜ï¼š</span>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0 åè®®</a>ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
      </div>
    
  </div>
</article>
<div class="nav">
  
    <div class="nav-item-prev">
      <a 
        href="/USTC%E5%AE%BF%E8%88%8D%E8%A3%85%E4%BF%AE%E7%90%86%E8%AE%BA%E4%B8%8E%E5%BA%94%E7%94%A8/" 
        class="nav-link">
        <i class="iconfont icon-left nav-prev-icon"></i>
        <div>
          <div class="nav-label">ä¸Šä¸€ç¯‡</div>
          
            <div class="nav-title">USTCå®¿èˆè£…ä¿®ç†è®ºä¸åº”ç”¨ </div>
          
        </div>
      </a>
    </div>
  
  
    <div class="nav-item-next">
      <a 
        href="/Graph-Neural-Network/" 
        class="nav-link">
        <div>
          <div class="nav-label">ä¸‹ä¸€ç¯‡</div>
          
            <div class="nav-title">Graph Neural Network </div>
          
        </div>
        <i class="iconfont icon-right nav-next-icon"></i>
      </a>
    </div>
  
</div>

  <div 
    class="card card-content comment-card" 
    style="margin-top: 16px;">
    <div class="comment-card-title">è¯„è®º</div>
    
  <div id="gitalk-container"></div>
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

  
<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  
<script src="/js/lib/md5.min.js"></script>

  <script>
    var gitalk = new Gitalk({
      clientID: '049b30eb10ea05082ef1',
      clientSecret: 'c33ad95041c69907b3136b895008320f000987db',
      repo: 'Ch3nYe.github.io',
      owner: 'Ch3nYe',
      admin: "Ch3nYe",
      id: md5(location.href),
      distractionFreeMode: false,
      language: 'navigator.language || navigator.userLanguage',
      labels: ["Gitalk"],
      perPage: 10
    })

    gitalk.render('gitalk-container')
  </script>

  </div>

<div 
  class="card card-content toc-card" 
  id="mobiletoc">
  <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>ç›®å½•
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0"><span class="toc-text"> Glibcå†…å­˜ç®¡ç†ç¬”è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0-%E8%83%A1%E8%AF%9D"><span class="toc-text"> 0x0 èƒ¡è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E8%BF%99%E7%AF%87%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%86%99%E4%BB%80%E4%B9%88%E9%AC%BC"><span class="toc-text"> 0x1 è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text"> 0x2 çŸ¥è¯†ç‚¹?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E7%9B%B8%E5%85%B3"><span class="toc-text"> chunk ç›¸å…³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text"> æ ¸å¿ƒç»“æ„ä½“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x-1%E7%BB%8F%E5%85%B8%E8%87%AA%E9%97%AE%E8%87%AA%E7%AD%94%E7%8E%AF%E8%8A%82"><span class="toc-text"> 0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E5%A4%A7%E5%B0%8F%E7%9A%84%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F"><span class="toc-text"> Chunk å¤§å°çš„è®¡ç®—å…¬å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84chunk%E5%8F%AF%E4%BB%A5%E5%8D%A0%E7%94%A8%E4%B8%8B%E4%B8%80%E4%B8%AAchunk%E7%9A%84prev_size%E5%9F%9F"><span class="toc-text"> ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„Chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88chunk%E7%9A%84size%E5%9F%9F%E4%BD%8E%E4%B8%89%E4%BD%8D%E5%8F%AF%E4%BB%A5%E5%A4%8D%E7%94%A8"><span class="toc-text"> ä¸ºä»€ä¹ˆChunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-bins-%E5%A6%82%E4%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text"> Chunk Bins å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E5%8C%BAarena%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3"><span class="toc-text"> åˆ†é…åŒº(arena)æ€ä¹ˆç†è§£ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-arena%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BAnon-main-arena-%E9%9D%9E%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BA%E6%99%AE%E9%80%9Aarena%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86"><span class="toc-text"> main arenaä¸»åˆ†é…åŒº&amp;non main arena éä¸»åˆ†é…åŒºï¼ˆæ™®é€šarenaï¼‰å¦‚ä½•åŒºåˆ†ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#malloc%E4%B8%ADmmap%E5%92%8Cbrk%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> mallocä¸­mmapå’Œbrkçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text"> å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%A1%BA%E5%BA%8F%E9%98%85%E8%AF%BB"><span class="toc-text"> æ¨èé¡ºåºé˜…è¯»ï¼š</span></a></li></ol></li></ol>
</div></main>
            <aside class="left-column">
              
              <div class="card card-author">
                
  <img 
    src="/images/logo.png" 
    class="author-img"
    width="88"
    height="88"
    alt="author avatar">

<p class="author-name">Ch3nYe</p>
<p class="author-description">å¦‚æœæœ‰æ–‡ç« æœ‰ä»»ä½•é”™è¯¯è¯·ç•™è¨€ï¼Œè°¢è°¢ğŸ™</p>
<div class="author-message">
  <a 
    class="author-posts-count" 
    href="/archives">
    <span>41</span>
    <span>æ–‡ç« </span>
  </a>
  <a 
    class="author-categories-count" 
    href="/categories">
    <span>7</span>
    <span>åˆ†ç±»</span>
  </a>
  <a 
    class="author-tags-count" 
    href="/tags">
    <span>62</span>
    <span>æ ‡ç­¾</span>
  </a>
</div>

  <div class="author-card-society">
    
      <div class="author-card-society-icon">
        <a target="_blank" rel="noopener" href="https://github.com/ch3nye/">
          <i class="iconfont icon-github society-icon"></i>
        </a>
      </div>
    
      <div class="author-card-society-icon">
        <a href="mailto:sud0su@163.com">
          <i class="iconfont icon-mail society-icon"></i>
        </a>
      </div>
    
  </div>

              </div>
               <div class="sticky-tablet">
  
  
    <article class="display-when-two-columns spacer">
      <div class="card card-content toc-card">
        <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>ç›®å½•
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0"><span class="toc-text"> Glibcå†…å­˜ç®¡ç†ç¬”è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0-%E8%83%A1%E8%AF%9D"><span class="toc-text"> 0x0 èƒ¡è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E8%BF%99%E7%AF%87%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%86%99%E4%BB%80%E4%B9%88%E9%AC%BC"><span class="toc-text"> 0x1 è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text"> 0x2 çŸ¥è¯†ç‚¹?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E7%9B%B8%E5%85%B3"><span class="toc-text"> chunk ç›¸å…³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text"> æ ¸å¿ƒç»“æ„ä½“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x-1%E7%BB%8F%E5%85%B8%E8%87%AA%E9%97%AE%E8%87%AA%E7%AD%94%E7%8E%AF%E8%8A%82"><span class="toc-text"> 0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E5%A4%A7%E5%B0%8F%E7%9A%84%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F"><span class="toc-text"> Chunk å¤§å°çš„è®¡ç®—å…¬å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84chunk%E5%8F%AF%E4%BB%A5%E5%8D%A0%E7%94%A8%E4%B8%8B%E4%B8%80%E4%B8%AAchunk%E7%9A%84prev_size%E5%9F%9F"><span class="toc-text"> ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„Chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88chunk%E7%9A%84size%E5%9F%9F%E4%BD%8E%E4%B8%89%E4%BD%8D%E5%8F%AF%E4%BB%A5%E5%A4%8D%E7%94%A8"><span class="toc-text"> ä¸ºä»€ä¹ˆChunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-bins-%E5%A6%82%E4%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text"> Chunk Bins å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E5%8C%BAarena%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3"><span class="toc-text"> åˆ†é…åŒº(arena)æ€ä¹ˆç†è§£ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-arena%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BAnon-main-arena-%E9%9D%9E%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BA%E6%99%AE%E9%80%9Aarena%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86"><span class="toc-text"> main arenaä¸»åˆ†é…åŒº&amp;non main arena éä¸»åˆ†é…åŒºï¼ˆæ™®é€šarenaï¼‰å¦‚ä½•åŒºåˆ†ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#malloc%E4%B8%ADmmap%E5%92%8Cbrk%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> mallocä¸­mmapå’Œbrkçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text"> å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%A1%BA%E5%BA%8F%E9%98%85%E8%AF%BB"><span class="toc-text"> æ¨èé¡ºåºé˜…è¯»ï¼š</span></a></li></ol></li></ol>
      </div>
    </article>
  
  
  <article class="card card-content categories-widget">
    <div class="categories-card">
  <div class="categories-header">
    <i 
      class="iconfont icon-fenlei" 
      style="padding-right: 2px;">
    </i>åˆ†ç±»
  </div>
  <div class="categories-list">
    
      <a href="/categories/%E7%94%9F%E6%B4%BB/">
        <div class="categories-list-item">
          ç”Ÿæ´»
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/%E5%A4%87%E5%BF%98/">
        <div class="categories-list-item">
          å¤‡å¿˜
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
      <a href="/categories/%E6%9D%8E%E5%AE%8F%E6%AF%85%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          æå®æ¯…æœºå™¨å­¦ä¹ ç¬”è®°
          <span class="categories-list-item-badge">15</span>
        </div>
      </a>
    
      <a href="/categories/%E8%AE%BA%E6%96%87%E9%98%85%E8%AF%BB/">
        <div class="categories-list-item">
          è®ºæ–‡é˜…è¯»
          <span class="categories-list-item-badge">11</span>
        </div>
      </a>
    
      <a href="/categories/%E5%AE%9E%E6%88%98/">
        <div class="categories-list-item">
          å®æˆ˜
          <span class="categories-list-item-badge">3</span>
        </div>
      </a>
    
      <a href="/categories/%E7%AC%94%E8%AE%B0/">
        <div class="categories-list-item">
          ç¬”è®°
          <span class="categories-list-item-badge">6</span>
        </div>
      </a>
    
      <a href="/categories/%E7%BF%BB%E8%AF%91/">
        <div class="categories-list-item">
          ç¿»è¯‘
          <span class="categories-list-item-badge">2</span>
        </div>
      </a>
    
  </div>
</div>
  </article>
  
  <article class="card card-content tags-widget">
    <div class="tags-card">
  <div class="tags-header">
    <i 
      class="iconfont icon-biaoqian" 
      style="padding-right: 2px;">
    </i>çƒ­é—¨æ ‡ç­¾
  </div>
  <div class="tags-list">
    
      <a 
        href="/tags/note/" 
        title="note">
        <div class="tags-list-item">note</div>
      </a>
    
      <a 
        href="/tags/ML/" 
        title="ML">
        <div class="tags-list-item">ML</div>
      </a>
    
      <a 
        href="/tags/Next-Step-of-ML/" 
        title="Next-Step-of-ML">
        <div class="tags-list-item">Next-Step-of-ML</div>
      </a>
    
      <a 
        href="/tags/%E7%AC%94%E8%AE%B0/" 
        title="ç¬”è®°">
        <div class="tags-list-item">ç¬”è®°</div>
      </a>
    
      <a 
        href="/tags/%E8%AE%BA%E6%96%87/" 
        title="è®ºæ–‡">
        <div class="tags-list-item">è®ºæ–‡</div>
      </a>
    
      <a 
        href="/tags/Android/" 
        title="Android">
        <div class="tags-list-item">Android</div>
      </a>
    
      <a 
        href="/tags/%E6%80%BB%E7%BB%93/" 
        title="æ€»ç»“">
        <div class="tags-list-item">æ€»ç»“</div>
      </a>
    
      <a 
        href="/tags/Deep-Learning/" 
        title="Deep-Learning">
        <div class="tags-list-item">Deep-Learning</div>
      </a>
    
      <a 
        href="/tags/%E5%AD%A6%E4%B9%A0/" 
        title="å­¦ä¹ ">
        <div class="tags-list-item">å­¦ä¹ </div>
      </a>
    
      <a 
        href="/tags/%E5%AE%9E%E6%88%98/" 
        title="å®æˆ˜">
        <div class="tags-list-item">å®æˆ˜</div>
      </a>
    
      <a 
        href="/tags/crack/" 
        title="crack">
        <div class="tags-list-item">crack</div>
      </a>
    
      <a 
        href="/tags/%E4%BA%8C%E8%BF%9B%E5%88%B6/" 
        title="äºŒè¿›åˆ¶">
        <div class="tags-list-item">äºŒè¿›åˆ¶</div>
      </a>
    
      <a 
        href="/tags/Binary/" 
        title="Binary">
        <div class="tags-list-item">Binary</div>
      </a>
    
      <a 
        href="/tags/%E7%BF%BB%E8%AF%91/" 
        title="ç¿»è¯‘">
        <div class="tags-list-item">ç¿»è¯‘</div>
      </a>
    
      <a 
        href="/tags/Rust/" 
        title="Rust">
        <div class="tags-list-item">Rust</div>
      </a>
    
      <a 
        href="/tags/HTTPS/" 
        title="HTTPS">
        <div class="tags-list-item">HTTPS</div>
      </a>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
            <aside class="right-column">
              <div class="sticky-widescreen">
  
  
    <article class="card card-content toc-card">
      <div class="toc-header">
  <i 
    class="iconfont icon-menu" 
    style="padding-right: 2px;">
  </i>ç›®å½•
</div>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#glibc%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AC%94%E8%AE%B0"><span class="toc-text"> Glibcå†…å­˜ç®¡ç†ç¬”è®°</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x0-%E8%83%A1%E8%AF%9D"><span class="toc-text"> 0x0 èƒ¡è¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x1-%E8%BF%99%E7%AF%87%E7%AC%94%E8%AE%B0%E5%9C%A8%E5%86%99%E4%BB%80%E4%B9%88%E9%AC%BC"><span class="toc-text"> 0x1 è¿™ç¯‡ç¬”è®°åœ¨å†™ä»€ä¹ˆé¬¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x2-%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-text"> 0x2 çŸ¥è¯†ç‚¹?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E7%9B%B8%E5%85%B3"><span class="toc-text"> chunk ç›¸å…³</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text"> æ ¸å¿ƒç»“æ„ä½“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x-1%E7%BB%8F%E5%85%B8%E8%87%AA%E9%97%AE%E8%87%AA%E7%AD%94%E7%8E%AF%E8%8A%82"><span class="toc-text"> 0x-1ç»å…¸è‡ªé—®è‡ªç­”ç¯èŠ‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-%E5%A4%A7%E5%B0%8F%E7%9A%84%E8%AE%A1%E7%AE%97%E5%85%AC%E5%BC%8F"><span class="toc-text"> Chunk å¤§å°çš„è®¡ç®—å…¬å¼ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8%E4%B8%AD%E7%9A%84chunk%E5%8F%AF%E4%BB%A5%E5%8D%A0%E7%94%A8%E4%B8%8B%E4%B8%80%E4%B8%AAchunk%E7%9A%84prev_size%E5%9F%9F"><span class="toc-text"> ä¸ºä»€ä¹ˆä½¿ç”¨ä¸­çš„Chunkå¯ä»¥å ç”¨ä¸‹ä¸€ä¸ªchunkçš„prev_sizeåŸŸï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88chunk%E7%9A%84size%E5%9F%9F%E4%BD%8E%E4%B8%89%E4%BD%8D%E5%8F%AF%E4%BB%A5%E5%A4%8D%E7%94%A8"><span class="toc-text"> ä¸ºä»€ä¹ˆChunkçš„sizeåŸŸä½ä¸‰ä½å¯ä»¥å¤ç”¨ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#chunk-bins-%E5%A6%82%E4%BD%95%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text"> Chunk Bins å¦‚ä½•åˆå§‹åŒ–ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%85%8D%E5%8C%BAarena%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3"><span class="toc-text"> åˆ†é…åŒº(arena)æ€ä¹ˆç†è§£ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#main-arena%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BAnon-main-arena-%E9%9D%9E%E4%B8%BB%E5%88%86%E9%85%8D%E5%8C%BA%E6%99%AE%E9%80%9Aarena%E5%A6%82%E4%BD%95%E5%8C%BA%E5%88%86"><span class="toc-text"> main arenaä¸»åˆ†é…åŒº&amp;non main arena éä¸»åˆ†é…åŒºï¼ˆæ™®é€šarenaï¼‰å¦‚ä½•åŒºåˆ†ï¼Ÿ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#malloc%E4%B8%ADmmap%E5%92%8Cbrk%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text"> mallocä¸­mmapå’Œbrkçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%AD%98%E7%A2%8E%E7%89%87%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-text"> å†…å­˜ç¢ç‰‡å‡ºç°çš„åŸå› </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A8%E8%8D%90%E9%A1%BA%E5%BA%8F%E9%98%85%E8%AF%BB"><span class="toc-text"> æ¨èé¡ºåºé˜…è¯»ï¼š</span></a></li></ol></li></ol>
    </article>
  
  
  <article class="card card-content">
    <div class="recent-posts-card">
  <div class="recent-posts-header">
    <i 
      class="iconfont icon-wenzhang_huaban" 
      style="padding-right: 2px;">
    </i>æœ€è¿‘æ–‡ç« 
  </div>
  <div class="recent-posts-list">
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-04-13</div>
        <a href="/%E4%BB%8Epython%E8%B0%83%E7%94%A8rust-%E4%BD%BF%E7%94%A8rust%E5%8A%A0%E9%80%9F%E4%BD%A0%E7%9A%84python%E4%BB%A3%E7%A0%81/"><div class="recent-posts-item-content">ä»pythonè°ƒç”¨rust-ä½¿ç”¨ruståŠ é€Ÿä½ çš„pythonä»£ç </div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-03-28</div>
        <a href="/%E5%A6%82%E4%BD%95%E7%94%A8%20Rust%20%E5%AE%9E%E7%8E%B0%E6%9C%B4%E7%B4%A0%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%88%86%E7%B1%BB%E5%99%A8/"><div class="recent-posts-item-content">å¦‚ä½•ç”¨ Rust å®ç°æœ´ç´ è´å¶æ–¯åˆ†ç±»å™¨</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-03-25</div>
        <a href="/%E5%85%B3%E4%BA%8E%E7%94%A8Rust%E5%86%99%E7%AE%97%E6%B3%95%E9%A2%98%E7%9A%84%E5%A7%BF%E5%8A%BF%E6%8E%A2%E8%AE%A8%E4%BB%A5%E5%8F%8AWindows11%E8%B0%83%E8%AF%95Rust%E7%9A%84%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/"><div class="recent-posts-item-content">å…³äºç”¨Rustå†™ç®—æ³•é¢˜çš„å§¿åŠ¿æ¢è®¨ä»¥åŠWindows11è°ƒè¯•Rustçš„ç¯å¢ƒé…ç½®</div></a>
      </div>
    
      <div class="recent-posts-item">
        <div class="recent-posts-item-title">2022-02-17</div>
        <a href="/Note-Nero/"><div class="recent-posts-item-content">Note ã€ŠNeural reverse engineering of stripped binaries using augmented control flow graphsã€‹</div></a>
      </div>
    
  </div>
</div>
  </article>
  
  
</div>
            </aside>
          </div>
        </div>
      </div>
    </div>
     
    <footer class="footer">
  <div class="footer-container">
    <div>
      <div class="footer-dsc">
        <span>
          Copyright Â©
          
            2020 -
          
          2022
        </span>
        &nbsp;
        <a 
          href="/" 
          class="footer-link">
          ch3nye's blog
        </a>
      </div>
    </div>

    
      <div class="footer-dsc">
        
          Powered by
          <a 
            href="https://hexo.io/" 
            class="footer-link" 
            target="_blank" 
            rel="nofollow noopener noreferrer">
            &nbsp;Hexo
          </a>
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          Theme -
          <a 
            href="https://github.com/theme-kaze" 
            class="footer-link" 
            target="_blank"
            rel="nofollow noopener noreferrer">
            &nbsp;Kaze
          </a>
        
      </div>
    
    
    
    
      <div class="footer-dsc">
        
          æœ¬ç«™æ€»è®¿é—®é‡<span id="busuanzi_value_site_pv"></span>æ¬¡
        
        
          <span>&nbsp;|&nbsp;</span>
        
        
          æœ¬ç«™æ€»è®¿å®¢æ•°<span id="busuanzi_value_site_uv"></span>æ¬¡
        
      </div>
      
    
<!-- Default Statcounter code for My Blog https://ch3nye.top -->
<script type="text/javascript">
var sc_project=12696483; 
var sc_invisible=1; 
var sc_security="0f70f90d"; 
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><a title="Web Analytics"
href="https://statcounter.com/" target="_blank"><img class="statcounter"
src="https://c.statcounter.com/12696483/0/0f70f90d/1/" alt="Web Analytics"
referrerPolicy="no-referrer-when-downgrade"></a></div></noscript>
<!-- End of Statcounter Code -->
</footer> 
    
  <a 
    role="button" 
    id="scrollbutton" 
    class="basebutton" 
    aria-label="å›åˆ°é¡¶éƒ¨">
    <i class="iconfont icon-arrowleft button-icon"></i>
  </a>

<a 
  role="button" 
  id="menubutton"
  aria-label="menu button"
  class="basebutton">
  <i class="iconfont icon-menu button-icon"></i>
</a>
<a 
  role="button" 
  id="popbutton" 
  class="basebutton" 
  aria-label="æ§åˆ¶ä¸­å¿ƒ">
  <i class="iconfont icon-expand button-icon"></i>
</a>
<a 
  role="button" 
  id="darkbutton" 
  class="basebutton darkwidget" 
  aria-label="å¤œè‰²æ¨¡å¼">
  <i class="iconfont icon-weather button-icon"></i>
</a>
<a 
  role="button" 
  id="searchbutton" 
  class="basebutton searchwidget" 
  aria-label="æœç´¢">
  <i class="iconfont icon-search button-icon"></i>
</a> 
     
     
      

  
  
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css">

  
 
     
     
      <script>
  var addImgLayout = function () {
    var img = document.querySelectorAll('.post-content img')
    var i
    for (i = 0; i < img.length; i++) {
      var wrapper = document.createElement('a')
      wrapper.setAttribute('href', img[i].getAttribute('data-src'))
      wrapper.setAttribute('aria-label', 'illustration')
      wrapper.style.cssText =
        'width: 100%; display: flex; justify-content: center;'
      if (img[i].alt) wrapper.dataset.caption = img[i].alt
      wrapper.dataset.nolink = true
      img[i].before(wrapper)
      wrapper.append(img[i])
      var divWrap = document.createElement('div')
      divWrap.classList.add('gallery')
      wrapper.before(divWrap)
      divWrap.append(wrapper)
    }
    baguetteBox.run('.gallery')
  }
</script>
<script>
  loadScript(
    "/js/lib/lightbox/baguetteBox.min.js",
    addImgLayout
  )
</script>
 
     
     
    <script src="/js/main.js"></script> 
    
      <script> 
        loadScript('/js/lib/busuanzi.min.js') 
      </script>
     
    
      <script>
        var addLazyload = function () {
          var observer = lozad('.lozad', {
            load: function (el) {
              el.srcset = el.getAttribute('data-src')
            },
            loaded: function (el) {
              el.classList.add('loaded')
            },
          })
          observer.observe()
        }
      </script>
      <script>
        loadScript('/js/lib/lozad.min.js', addLazyload)
      </script>
     
    
      <script>
        var googleAnalytics = function () {
          window.dataLayer = window.dataLayer || []
          function gtag() {
            dataLayer.push(arguments)
          }
          gtag('js', new Date())
          gtag('config', 'G-WHGL11014T')
        }
    </script>
      <script>
        loadScript(
          'https://www.googletagmanager.com/gtag/js?id=' +
            'G-WHGL11014T',
          googleAnalytics
        )
      </script>
    
    
      <script>
        setTimeout(() => {localSearch("search.json")}, 0)
      </script>
    
  </body>
</html>
